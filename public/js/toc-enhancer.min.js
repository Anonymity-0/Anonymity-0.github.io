document.addEventListener("DOMContentLoaded",function(){const s=document.getElementById("floating-toc"),a=document.getElementById("toc-toggle"),d=document.getElementById("toc-content"),i=document.querySelector(".widget--toc .TableOfContents"),l=document.querySelector(".article-content");if(!s||!i||!l)return;const n=l.querySelectorAll("h1, h2, h3, h4, h5, h6"),o=i.querySelectorAll("a");n.forEach((e,t)=>{e.id||(e.id=`heading-${t}`)});let e=!1;function t(){e=!e,d.classList.toggle("expanded",e),a.classList.toggle("expanded",e),localStorage.setItem("tocExpanded",e)}const h=localStorage.getItem("tocExpanded");h==="true"&&(e=!0,d.classList.add("expanded"),a.classList.add("expanded")),a.addEventListener("click",t),document.addEventListener("click",function(n){!s.contains(n.target)&&e&&t()}),o.forEach(n=>{const s=n.getAttribute("href");if(s&&s.startsWith("#")){const i=s.substring(1),o=document.getElementById(i);o&&n.addEventListener("click",function(s){s.preventDefault(),o.scrollIntoView({behavior:"smooth",block:"start"}),c(n),e&&setTimeout(()=>t(),300)})}});let r=!1;function c(e=null){o.forEach(e=>e.classList.remove("active")),e&&e.classList.add("active")}function u(){if(r)return;r=!0,requestAnimationFrame(()=>{let e=null;const t=window.pageYOffset,a=100,o=t>300&&n.length>0;s.style.opacity=o?"0.9":"0",s.style.visibility=o?"visible":"hidden";for(let s=n.length-1;s>=0;s--){const o=n[s],i=o.offsetTop;if(t+a>=i){e=o;break}}if(e){const t=i.querySelector(`a[href="#${e.id}"]`);c(t)}r=!1})}window.addEventListener("scroll",u,{passive:!0}),o.length>0&&c(o[0]),u(),document.addEventListener("keydown",function(n){if((n.key==="t"||n.key==="T")&&!n.ctrlKey&&!n.altKey&&!n.metaKey){const e=document.activeElement,s=e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.contentEditable==="true";s||(n.preventDefault(),t())}n.key==="Escape"&&e&&t()})})