---
title: "信息网络协议基础第二章复习"
description: 
date: 2024-01-02T11:54:05+08:00
image: 
math: 
license: 
hidden: false
comments: true
draft: false
categories:
    - 信息网络协议基础
tags:
    - 学习笔记
---



## 接入网
- 用来把用户网络或者设备接入到Internet的网络
- 也被称为最后1公里接入
- 宽带接入成为主流（FCC [2010]: 4Mbps downstream/1Mbps upstream)
- DSL、Cable、Fibre、Wireless Broadband (Fixed/Mobile)

### 常用接入网类型
- 基于ATM架构类
	- 传统电信网络：<font color="#ff0000">点对点</font>
	- DSL（数字用户线路）
		- 对称DSL
			- 下行和上行速率相同SHDSL(利用了话音带宽）
		- 非对称DSL
			- 下行速率一般大于上行速率
			- ADSL
			- ADSL2+:
- 基于IEEE 802参考模型的局域网架构类
	- 新兴IP网络：<font color="#ff0000">共享</font>
	- 以太网（802.3）、无线局域网（802.11）、甚至包括无线城域网（802.16）
- 光纤接入类
	- 基于ATM：APON、GPON
	- 基于以太网：EPON

## ATM
### 概述
- ATM： Asynchronous Transfer Mode，异步传输模式
	- 既可用于接入网，也可以用于核心网

- 面向连接的分组交换/虚电路交换
	- Q.2931：连接建立信令
	- 信元：基本交换单位，固定长度（5字节头标＋48字节数据）
	- ==为什么选择固定长度（53字节）的信元？==
		- ==1）构建硬件简单==
		- ==2）交换单元并行处理==
		- ==3）队列行为优化：控制延迟、提高队列处理效率==

### 信元
队列优化举例：
假设：链路带宽100Mbps，队列中的分组具有不同的优先级
变长分组网络：最大分组长度为4KB，在交换机开始传输一个4KB的分组之后到达一个高优先级的分组，必须在队列中等待327.68us才能通过输出端口传输（4KB= 32768b）
ATM网络：信元固定长度为53B，最长等待时间将是53×8/100=4.24us，而且这个时间是固定的
结论：使用固定长度信元具有控制延迟的能力，特别是控制延迟抖动的能力，这对某些应用例如实时应用非常重要

### 业务类型
- CBR业务  Constant Bit Rate
	- 提供<font color="#ff0000">最高程度</font>的服务质量保证，保证带宽、延迟抖动
	- 话音、视频等
- VBR业务  Variable Bit Rate
	- 业务产生的数据可能是突发的，要求延迟抖动小
	- 具有突发性，可保证最大延迟，压缩话音、视频
- ABR业务  Available Bit Rate
	- 利用剩余带宽，根据网络可用带宽和拥塞状态来调整传输速率
	- 文件传输、email等
- UBR业务  Unspecified Bit Rate
	- 利用剩余带宽，对延迟和延迟抖动没有严格要求的业务
	- 文件传输、email等

### 虚电路
- 虚电路VPI和VCI来标识
	- VPI：Virtual Path Identification，虚路径标识
	- VCI：Virtual Channel Identification，虚通道标识
- Why VPI+VCI？
	- VPI用于网络的主干中进行切换。它在ATM交换机上起到多路复用/解复用的作用，将来自各种源（ATM接口）的虚拟信道（VCs）汇聚到一个接口上的虚拟路径
	- 另一方面，VCI用于在私有网络内标识连接。
- Permanent Virtual Circuit (PVC)
	- PVC是一种永久建立的连接，它使得在节点之间的物理连接上创建逻辑连接成为可能，这些节点经常或连续地进行通信
	- 网络设备的VPI/VCI表格可以由管理员进行更新
- Switched Virtual Circuit (SVC)
	- Switched Virtual Circuit (SVC) 是一种在数据通信网络中在两个网络设备之间建立的临时逻辑连接

### 信元格式

![[图片 1.png]]

### AAL
- 信元载荷的格式由AAL来决定 
	- AAL：ATM Adaptation Layer，ATM适配层
- Why AAL？
	- ATM可以用来承载可变长度的分组（例如IP分组），而ATM信元长度是固定的。
	- ![[Pasted image 20240102101545.png]]
- •根据传输业务的不同，分为AAL1～AAL5
	- AAL1：CBR、面向连接业务，例如恒定速率的音频和视频
	- AAL2：VBR业务，面向连接的业务，例如可变速率的音频和视频
	- AAL3/4：VBR、面向连接和无连接业务
	- AAL5：AAL3/4的简化版。最常用，**用来承载IP分组**


### ATM与点对点链路
- 在电话线接入中
	- 服务提供商事先给每个客户都事先分配了固定的VPI/VCI，大多使用PVC
	- 为了便于管理，服务提供商一般通过PPP over ATM技术，将PVC变成一个逻辑的点对点链路集合

## PPP

### 概述
- PPP是个数据链路层协议 ，通过PPP，完成：
	1. 链路建立、维护和终结
	2. 用户认证
	3. 网络参数协商，包括IP地址分配等
- 对于接入服务器来说，每条PPP链路的另一端对应着一个用户，因此便于认证、计费和管理
	- PPP链路的两端对应着通信双方，因此不存在寻址问题
	- 接入服务器要和AAA服务器(例如RADIUS)配合工作，以完成认证、计费等功能
		- AAA：认证、授权、计费

### 协议
- PPP：Point to Point Protocol
	- 在点对点链路上传输多种协议数据
- 协议构成
	- 封装方法
		- 封装各种协议数据的方法
		- 在同一条链路上同时复用各种不同的网络层协议
	- 链路控制协议（LCP：Link Control Protocol）
		- 建立、配置、维护和终结链路
	- 认证协议
		- PAP、CHAP
	- 网络控制协议（NCP：Network Control Protocol）
		- 建立和配置各种不同的网络层协议
		- 对于不同的网络层协议定义有不同的NCP，例如对于IP协议是IPCP
- ### 说明
	- PPP over ATM缺乏有效的QoS和组播支持能力
		- 业务均为ATM UBR类型，提供尽力服务
	- 视频、高质量音频、实时视频会议等服务质量要求高的应用必须选择原始的ATM协议栈


## ADSL
### 概述
- 早期电话拨号：局端过滤300Hz~ 3.4KHz 范围外的非话音频率
- 电话线的带宽> >4kHz（可用带宽2MHz左右。
- ADSL：ADSL将用户线路接到没有滤波器的线路上
- 频率在26khz以上的信号被分离到DSLAM(用户数字线访问复用)

### 关键技术
- 调制技术：DMT
- 关键设备：DSLAM
- 体系结构：ATM、PPPOE

现在大多使用ADSL Router取代ADSL MODEM，可以由ADSL Router直接进行PPPOE拨号；也可以是ADSL Router+宽带路由器，由宽带路由器执行PPPOE拨号。

### DMT
- DMT：离散多音（Discrete Multi-Tone），用于ADSL的调制方法
- 利用电话线的1104KHz带宽，划分为256个载波（多音，子信道），每个子信道带宽为4.3125KHz
	- 子信道0（0～4.3125KHz）：传统电话业务
	- 子信道1~5（4.3125～25.875KHz）：保护频带
	- 子信道6～31（25.875～138KHz）：26个上行信道
	- 子信道32～255（138～1104KHz）：224个下行信道
- 双向数据传输时，为了避免上行和下行之间的干扰，在31～32附近的信道不被使用（保护频带，位于138KHz左右）
- 速率自适应：DMT以自适应的方式分配各个子信道的速率，以达到最佳的传输线路利用率，例如让信噪比较高的信道传送更多的位，关闭被窄频噪声所覆盖的子信道

### ADSL带宽分析

### DSLAM
- DSLAM：Digital Subscriber Line Access Multiplexer，数字用户线路访问复用器
	- 将基于各种DSL技术的数字用户线路，包括ADSL，VDSL和SH.DSL，连接到运营商网络
	- DSLAM分为两侧，即用户侧和网络侧
	- 用户侧：DSLAM和Modem之间始终为ATM over DSL，即来自主机的以太帧被封装成ATM信元，然后通过DSL传输
	- 网络侧：早期为ATM，但是随着IP的普及，ATM逐渐被以太网所取代，这也代表了DSLAM的发展方向（IP化）

### PPPOE
#### Why PPPOE?
1. 用户希望能够通过一个CPE设备（用户前端设备，例如ADSL Modem）来接入多台主机
2. 实际网络运行经验表明，以太网（Ethernet）是一种有效而且成本很低的多主机接入技术，但是以太网不支持认证、计费等功能。运营上同时希望能够实现基于用户的访问控制和计费功能。在传统的拨号网络中，通过PPP可以对用户进行认证、计费
3. 一个自然的想法就是把以太网和PPP这两种技术结合起来，因此引入了PPPOE（PPP over Ethernet），在以太网上建立PPP连接，本质是在多路访链路上提供一条逻辑的点对点链路，也被称为PPPOE会话。

#### PPPOE分为两个阶段
- <font color="#ff0000">发现阶段</font>
	- 为了在以太网上建立PPP会话，通信双方必须知道对方的MAC地址，并且协商一个唯一的会话标识（Session_ID）
	- 主机发现网络中所有可用的BRAS（MAC地址），并且选择一个BRAS为其提供接入服务
	- 无状态，不会分配任何资源
- <font color="#ff0000">PPP会话阶段</font>
	- 标准的PPP过程，当PPP会话建立后，主机和BRAS为PPP会话分配资源

#### PPPOE帧格式
类型: <font color="#ff0000">0x8863  用于Discovery阶段的帧 0x8864 用于PPP会话阶段</font>
Code：<font color="#ff0000">0x00  PPP会话阶段、0x09 PADI、0x07 PADO、0x19  PADR、0x65 PADS、0xa7 PADT</font>

#### PPPOE的特点
- 通过PPPOE会话的建立和释放进行基于时间或者流量的统计，计费方式灵活方便
- 动态IP地址配置和管理
- 与传统拨号上网类似，提供基于用户名和密码的认证
- 由于存在多层协议封装，开销大


## 局域网
### 定义
局域网（LAN：Local Area Network）被定义为一个广播域，即在局域网内目的地址为广播地址的IP分组或者数据链路层帧会被所有的网络节点接收和处理
以太网是应用最广泛的局域网技术，对应着IEEE 802.3
### 局域网参考模型
- 数据链路层被划分为两个子层，即逻辑链路控制(LLC)子层和媒介访问控制(MAC)子层
	- 在传统的点对点链路控制中没有管理访问共享媒介的逻辑需求 ， MAC子层负责对共享链路访问进行控制
	- 对于相同的LLC子层，可以提供不同的MAC子层
		- 常用以太网、无线局域网等局域网具有相同的LLC子层，只是MAC子层不同

### LLC
- 功能：传输服务/ 到上层的服务接口/流量控制等
- LLC是一个对所有LAN都相同的链路层协议，它定义了两个用户之间数据交换的机制，提供了三种可选的服务
	- 无确认的非连接服务（Unacknowledged Connectionless Service） 
	- 连接模式服务（Connection-mode Service） 
	- 确认无连接服务（Acknowledged Connectionless Service） 
设备厂商将LLC服务作为可选项提供给客户，客户可以根据自己应用的需求选择合适的服务 
在大多数情况下，无确认的非连接服务是优先考虑的选项，但在一些不可靠的网络环境，例如无线网络，一般使用确认无连接服务

### MAC
- 功能：寻址/访问控制/差错控制/移动管理等
- 重点解决共享链路访问控制问题，具体的MAC机制与传输媒介的物理特性相关
	- 有线：以太网、光网络等
	- 无线：无线局域网、无线城域网等
- CSMA/CD是最经典的MAC机制，在以太网（802.3）中使用

- 为什么引入MAC
	- <font color="#ff0000">寻址问题</font>：在共享链路上，任何主机都能够接收其它主机发送的数据，因此需要一种机制来指明数据的接收者
	- 主机发送数据时以帧为单位，帧的头标中包含了接收这个帧的目的地址，即目的MAC地址
### 共享链路问题
- <font color="#ff0000">访问控制问题</font>：在共享链路上，需要一种机制协调所有主机之间的数据发送，以公平竞争访问链路。
	- 解决方法：每个数据帧都有最大长度限制（数据域部分不超过1500字节），发送完后主机之间要重新使用CSMA/CD机制协调对共享链路的访问
- 冲突
	- 也叫做碰撞，由多台主机争用传输介质引起的。当连接在共享链路上的两台或两台以上主机同时发送数据时，表示这些数据的信号将在同一段传输介质上叠加，从而导致无法被接收主机正确接收。

### CSMA/CD
- 载波侦听（Carrier Sense）：当某台主机想要发送数据时，它首先侦听媒介是否忙，如果是，表示当前有其它主机正在传输数据，因此将继续侦听，直到媒介空闲，然后发送数据
- 冲突检测（Collision Detection）：如果主机在数据发送过程中检测到冲突，则发送干扰信号（jamming signal），以确保所有主机都知道发生了冲突，并且取消发送
	- 当检测冲突后，将等待一个随机的时间，也称作退避（backoff） 
	- 二进制指数退避算法（binary exponential backoff）来确定随机等待时间时间被划分为离散的时槽，一般设置为51.2us 当第k次冲突发生后，从集合{0，1，….，2k-1}中随机选择一个数r，然后等待r个时槽。如果k>=10，则保持集合{0，1，….，210-1} 不变。如果k>16，则放弃发送，并产生错误  

### 分布式协调功能DCF（Distributed Coordination Function） 

<font color="#ff0000">冲突避免CA而不是冲突检测CD，在无线环境下很难检测到冲突</font>
两种CSMA/CA操作
- 基本CSMA/CA：采用物理信道侦听方法 ，该操作强制要求必须使用
- 扩展CSMA/CA：采用虚拟信道侦听方法，使用两个控制帧，即RTS/CTS，可解决隐藏站点问题，该操作是可选的，可以根据需要配置

### 基本CSMA/CA
- 包括载波侦听和冲突避免两个过程
- 载波侦听 ：站点在发送帧之前侦听无线信道是否空闲，如果是，则进入冲突避免阶段，如果当前信道忙，说明现在有其它站点正在传输数据，则延迟发送帧直到侦听到信道空闲
- 冲突避免：站点在发送帧之前要先等待一个帧间间隔IFS（InterFrame Spacing），并且确保在IFS时间内信道空闲
- 为了防止多个站点在等待IFS时间后同时发送而导致冲突，与以太网类似，引入了一个随机退避算法来选择一个退避时间 （backoff time）

#### IFS
帧间间隔（IFS）控制了发送帧之前的等待时间，不同类型的帧具有不同的IFS，确定了帧的发送优先级，IFS越短，帧的优先级就越高 。
三种IFS
- SIFS：Short IFS，最高优先级，用于CTS、ACK等控制帧
- PIFS：PCF IFS，等于SIFS+1，中等优先级，用于PCF操作模式下的帧
- DIFS：DCF IFS，等于SIFS+2，最低优先级，用于DCF操作模式下的数据帧

#### 退避时间
- 站点执行随机退避算法来确定退避时间
	- 从0到竞争窗口CW之间的随机选择一个值r，则退避时间为r倍的时槽
- 竞争窗口CW（Contention Window ）采用与以太网类似的指数退避算法来设置
	- CW初始化为一个最小值CWmin
	- 当发送方认为发送的帧发生冲突时将CW加倍增大，直到到达最大值CWmax
	- 竞争窗口CW: 开始为2k-1，下一次为2k+1-1

#### 判断冲突
- .接收方发送ACK帧
	- 接收方正确接收来自发送方的数据帧后发送ACK帧进行确认
	- ACK帧不需要执行随机退避算法，而是直接等待一个SIFS时间后就发送
- 发送方未收到ACK帧
	- 发送方执行指数退避算法，将CW的值加倍，并且将重传计数器加1，然后重传数据帧，此时需要再次使用CSMA/CA机制竞争信道
	- CW从CWmin开始，每次重传都将CW加倍，直到到达CWmax
	- 重传计数器到达一个设定的门限值时，发送方将放弃发送数据帧，并且返回一个错误

### 扩展CSMA/CA
- RTS帧：与数据帧发送方式相同
- CTS帧：与控制帧发送方式相同，等待SIFS时间后直接发送
- 网络分配向量（NAV：Network Allocation Vector）：设置计数器，当减为0后，其他站点开始竞争信道
	- <font color="#ff0000">只有当RTS/CTS中的持续时间域的值大于当前存储的NAV时，该NAV才会被更新</font>
#### 原理
![[Pasted image 20240102111606.png]]
- 发送方发送RTS帧，其中包含了一个持续时间域，该域的值表明发送方完成帧交换所需要的时间，包括从发送数据帧到接收ACK帧所需要的时间
- 收到RTS的站点根据其中的持续时间为自己声明一个虚拟信道，并且该信道正忙，用网络分配向量NAV来表示，在NAV时间内，该站点不会尝试发送帧
- 接收方响应CTS帧中也包含一个持续时间域，该域的值足够大，以保证发送方能够完成数据帧交换
- 收到CTS的站点根据其中的持续时间为自己声明一个虚拟信道，并且该信道正忙，用网络分配向量NAV来表示，在NAV时间内，该站点不会尝试发送帧

#### 为什么要拓展
基本CSMA/CA存在：
- <font color="#ff0000"> 隐藏站点问题</font>：B给C发，D无法侦听到
- <font color="#ff0000">暴露站点问题</font>：B给A发，C侦听到忙，无法给D发
扩展CSMA/CA可解决隐藏站点问题
	B和D在彼此通信范围之外，他们互为隐藏站点，当B往C发送时，D CD失败，反过来D往C发送时，B CD失败。基本的CSMA/CA机制无法解决隐藏站点问题


### 切换
•站点移出一个AP的信号覆盖范围外，进入另一个AP的信号覆盖范围内，这时它需要关联到一个新的AP上。这个过程被称为切换（Handoff）
#### 切换过程
- 首先，站点决定何时开始切换过程
	- 信号强度减弱
	- 帧重传
	- 基础设施网络中无法接收到AP周期性广播的信标帧（缺省情况下AP周期性广播信标帧，其中包含有SSID等信息）
- 其次，站点决定切换到何处
	- 通过扫描机制得到所有AP的信息
		- 主动扫描速度快,但是开销大,目前大多数802.11产品都采用主动扫描
		- 主动扫描(Active Scanning)：在每个信道上发送探测请求帧，然后等待来自工作在该信道上的AP的探测响应帧，从而得到所有信道上的所有AP信息 
		- 被动扫描(Passive Scanning): 在每个信道上侦听来自AP的信标帧，从而得到所有信道上的所有AP信息
	- 根据SSID是否匹配、信号强度等信息选择一个新的AP
- 最后，站点将和选择的新的AP建立关联。建立关联之前STA还要和新的AP进行认证过程，然后开始关联过程
	- 在这里站点发送的是重新关联帧（Reassociation ）而不是关联帧  

### PON关键技术
- 下行采用广播方式传输，为保证安全性，需要对数据进行加密
- 上行需要考虑TDMA同步问题
- 实现动态带宽分配，提高带宽使用率，保证多业务服务质量
PON要解决的关键问题就是如何控制多个ONU/ONT对共享馈线光纤的高效访问

### GPON vs EPON
EPON直接将变长IP分组封装成以太帧，效率高，实现简单
GPON帧长为125us，无缝支持TDM业务
GPON继承了ATM的多业务支持，以业务类型为单位分配带宽
动态带宽分配属于GPON标准的一部分，但是在EPON中没有明确定义
GPON能够提供更高的速率，接入更多的ONU/ONT（最多128个）
